<!DOCTYPE html>
<html>
<head>
    <title>Team - IRCAD Africa Intranet</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .content {
            padding: 20px;
            width: 100%;
            max-width: none;
        }

        .department-section {
            margin-bottom: 40px;
        }

        .department-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #007bff;
        }

        .department-header h2 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.5rem;
        }

        .department-count {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .user-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.2s;
        }

        .user-card:hover {
            transform: translateY(-5px);
        }

        .user-header {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .profile-picture {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 4px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .default-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #007bff;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-size: 3rem;
        }

        .user-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0 0 5px;
        }

        .user-title {
            color: #6c757d;
            font-size: 0.9rem;
            margin: 0 0 15px;
        }

        .user-info {
            padding: 20px;
        }

        .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            color: #495057;
        }

        .info-item i {
            width: 20px;
            color: #007bff;
            margin-right: 10px;
        }

        .info-item a {
            color: #007bff;
            text-decoration: none;
        }

        .info-item a:hover {
            text-decoration: underline;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .content-header h1 {
            font-size: 2rem;
            margin: 0;
            color: #333;
        }

        .error-message {
            background: #dc3545;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .view-profile-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
            transition: background-color 0.2s;
        }

        .view-profile-btn:hover {
            background: #0056b3;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            position: relative;
            background: white;
            margin: 5% auto;
            padding: 20px;
            width: 90%;
            max-width: 600px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .modal-profile-picture {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            overflow: hidden;
        }

        .modal-profile-picture img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-title h2 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.8rem;
        }

        .modal-title p {
            margin: 5px 0 0;
            color: #6c757d;
            font-size: 1.1rem;
        }

        .modal-section {
            margin-bottom: 25px;
        }

        .modal-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .bio-content {
            line-height: 1.6;
            color: #495057;
        }

        .bio-content h1, .bio-content h2, .bio-content h3, .bio-content h4, .bio-content h5, .bio-content h6 {
            color: #2c3e50;
            margin: 1em 0 0.5em;
        }

        .bio-content p {
            margin: 0.5em 0;
        }

        .bio-content ul, .bio-content ol {
            margin: 0.5em 0;
            padding-left: 2em;
        }

        .bio-content a {
            color: #007bff;
            text-decoration: none;
        }

        .bio-content a:hover {
            text-decoration: underline;
        }

        .bio-content blockquote {
            border-left: 4px solid #007bff;
            margin: 1em 0;
            padding-left: 1em;
            color: #666;
        }

        .bio-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
        }

        .bio-content th, .bio-content td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .bio-content th {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <%- include('../partials/sidebar', { user: user, path: '/team' }) %>
        
        <main class="content">
            <div class="content-header">
                <h1>Our Team</h1>
            </div>

            <% if (error) { %>
                <div class="error-message"><%= error %></div>
            <% } %>

            <% for (const [department, users] of Object.entries(departments)) { %>
                <% if (users.length > 0) { %>
                    <div class="department-section">
                        <div class="department-header">
                            <h2><%= department %></h2>
                            <span class="department-count"><%= users.length %> members</span>
                        </div>
                        
                        <div class="team-grid">
                            <% users.forEach(teamMember => { %>
                                <div class="user-card">
                                    <div class="user-header">
                                        <% if (teamMember.profile_picture) { %>
                                            <img src="/uploads/profile-pictures/<%= teamMember.profile_picture %>" alt="<%= teamMember.full_name %>" class="profile-picture" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiB2aWV3Qm94PSIwIDAgMTIwIDEyMCI+CiAgPHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIxMjAiIGZpbGw9IiMwMDdiZmYiLz4KICA8dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iNDBweCI+CiAgICA8dHNwYW4gZHk9Ii0uM2VtIj7wn5GpPC90c3Bhbj4KICA8L3RleHQ+Cjwvc3ZnPg=='">
                                        <% } else { %>
                                            <div class="default-avatar">
                                                <i class="fas fa-user"></i>
                                            </div>
                                        <% } %>
                                        <h3 class="user-name"><%= teamMember.full_name || teamMember.username %></h3>
                                        <p class="user-title"><%= teamMember.job_title || 'Team Member' %></p>
                                    </div>
                                    
                                    <div class="user-info">
                                        <div class="info-item">
                                            <i class="fas fa-envelope"></i>
                                            <a href="mailto:<%= teamMember.email %>"><%= teamMember.email %></a>
                                        </div>
                                        <% if (teamMember.phone) { %>
                                            <div class="info-item">
                                                <i class="fas fa-phone"></i>
                                                <span><%= teamMember.phone %></span>
                                            </div>
                                        <% } %>
                                        <% if (teamMember.mobile_phone) { %>
                                            <div class="info-item">
                                                <i class="fas fa-mobile-alt"></i>
                                                <span><%= teamMember.mobile_phone %></span>
                                            </div>
                                        <% } %>
                                        <button class="view-profile-btn" 
                                            data-id="<%= teamMember.id %>"
                                            data-name="<%= teamMember.full_name || teamMember.username %>"
                                            data-title="<%= teamMember.job_title || 'Team Member' %>"
                                            data-email="<%= teamMember.email %>"
                                            data-phone="<%= teamMember.phone || '' %>"
                                            data-mobile="<%= teamMember.mobile_phone || '' %>"
                                            data-department="<%= teamMember.department %>"
                                            data-bio="<%= teamMember.bio || '' %>"
                                            data-profile-picture="<%= teamMember.profile_picture || '' %>"
                                            onclick="openProfileModal(this)">
                                            <i class="fas fa-user-circle"></i> View Profile
                                        </button>
                                    </div>
                                </div>
                            <% }) %>
                        </div>
                    </div>
                <% } %>
            <% } %>
        </main>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="modal-header">
                <div class="modal-profile-picture">
                    <img id="modalProfilePicture" src="" alt="Profile Picture">
                </div>
                <div class="modal-title">
                    <h2 id="modalName"></h2>
                    <p id="modalTitle"></p>
                </div>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h3>Contact Information</h3>
                    <div class="info-item">
                        <i class="fas fa-envelope"></i>
                        <a id="modalEmail" href=""></a>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-phone"></i>
                        <span id="modalPhone"></span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-mobile-alt"></i>
                        <span id="modalMobile"></span>
                    </div>
                </div>
                <div class="modal-section">
                    <h3>Department</h3>
                    <p id="modalDepartment"></p>
                </div>
                <div class="modal-section">
                    <h3>About</h3>
                    <div id="modalBio" class="bio-content"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function openProfileModal(button) {
            const modal = document.getElementById('profileModal');
            const profilePicture = document.getElementById('modalProfilePicture');
            
            // Set profile picture
            const profilePicturePath = button.dataset.profilePicture;
            if (profilePicturePath) {
                profilePicture.src = `/uploads/profile-pictures/${profilePicturePath}`;
            } else {
                profilePicture.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiB2aWV3Qm94PSIwIDAgMTIwIDEyMCI+CiAgPHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIxMjAiIGZpbGw9IiMwMDdiZmYiLz4KICA8dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iNDBweCI+CiAgICA8dHNwYW4gZHk9Ii0uM2VtIj7wn5GpPC90c3Bhbj4KICA8L3RleHQ+Cjwvc3ZnPg==';
            }
            profilePicture.onerror = function() {
                this.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiB2aWV3Qm94PSIwIDAgMTIwIDEyMCI+CiAgPHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIxMjAiIGZpbGw9IiMwMDdiZmYiLz4KICA8dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iNDBweCI+CiAgICA8dHNwYW4gZHk9Ii0uM2VtIj7wn5GpPC90c3Bhbj4KICA8L3RleHQ+Cjwvc3ZnPg==';
            };

            // Set other information
            document.getElementById('modalName').textContent = button.dataset.name;
            document.getElementById('modalTitle').textContent = button.dataset.title;
            document.getElementById('modalEmail').textContent = button.dataset.email;
            document.getElementById('modalEmail').href = `mailto:${button.dataset.email}`;
            document.getElementById('modalPhone').textContent = button.dataset.phone || 'Not provided';
            document.getElementById('modalMobile').textContent = button.dataset.mobile || 'Not provided';
            document.getElementById('modalDepartment').textContent = button.dataset.department;
            
            // Handle bio content
            const bioElement = document.getElementById('modalBio');
            try {
                const bio = button.dataset.bio;
                if (bio && bio.trim() !== '') {
                    bioElement.innerHTML = bio;
                } else {
                    bioElement.innerHTML = '<p>No bio available.</p>';
                }
            } catch (error) {
                console.error('Error displaying bio:', error);
                bioElement.innerHTML = '<p>No bio available.</p>';
            }

            modal.style.display = 'block';
        }

        // Close modal when clicking the X button
        document.querySelector('.close-modal').onclick = function() {
            document.getElementById('profileModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('profileModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html> 